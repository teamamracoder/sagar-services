<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Homepage{% endblock %}</title>

    {% block icon %}<link rel="icon" type="image/x-icon" href="../../static/img/companyLogo.png">{% endblock %}

    <!-- css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/datatables.min.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/scrollbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/toastr.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sujit.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/subhasis.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pawan.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/arif.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bipasha.css') }}">
    <!-- Owl carousel css -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" />

    <!-- js -->
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery-3.7.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.validate.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/datatables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/toastr.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/jquery.MultiFile.min.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

</head>

<body>


    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg sticky-top " id="nav">
        <div class="container-fluid" id="navContent">
            <a class="navbar-brand" href="{{ url_for('home.index') }}"><img class="companyLogo"
                    src="{{ url_for('static', filename='img/companyLogo.png') }}" alt="Logo"></a>
            <button class="navbar-toggler bg-white" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#NavBarForSagarservice" aria-controls="NavBarForSagarservice" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse ">
                <ul class="navbar-nav stroke ms-auto">
                    <li class="nav-item navtext">
                        <a class="nav-link " aria-current="page" href="{{ url_for('home.index') }}">Home</a>
                    </li>
                    <li class="nav-item navtext">
                        <a class="nav-link " href="{{ url_for('product.products_page') }}">Products</a>
                    </li>
                    <li class="nav-item navtext" id="service_section_nav_link_top">
                        <a class="nav-link " href="{{ url_for('home.index') }}#ServiceSection">Services</a>
                    </li>

                    <li class="nav-item navtext">
                        <a class="nav-link " href="{{ url_for('home.index') }}#CategorySection">Category</a>
                    </li>

                    <li class="nav-item navtext">
                        <a class="nav-link " href="{{ url_for('about_us.about_us_page') }}">About</a>
                    </li>
                    <li class="nav-item navtext">
                        <a class="nav-link" href="{{ url_for('contact_bp.contact_us_page') }}">Contact</a>
                    </li>
                </ul>


                <div class="navbar-nav ms-auto px-1">

                    <div class="Navbardropdown-container nav_login_div">

                    </div>
                </div>

                <ul class="navbar-nav nav_cart_wish_Btns" style="display: none;">
                    <li class="nav-item navtext">
                        <a class="nav-link wishBtn" href="{{ url_for('wishlist.wishlist_page') }}"><i
                                class="bi bi-heart"></i>
                            <span class="wishBtnTooltip" id="wishBtnTooltip"></span>
                        </a>

                    </li>
                    <li class="nav-item navtext">
                        <a class="nav-link cartBtn" aria-current="page" href="{{ url_for('cart.cart_page') }}"><i
                                class="bi bi-cart4"></i>
                            <span class="cartBtnTooltip" id="cartBtnTooltip"></span>

                        </a>
                    </li>

                </ul>
            </div>

        </div>
    </nav>

    <div class="offcanvas offcanvas-start ps-5 d-lg-none" data-bs-scroll="true" tabindex="-1" id="NavBarForSagarservice"
        aria-labelledby="sidebarBarLabel">
        <div class="offcanvas-header">
            <a class="navbar-brand" href="{{ url_for('home.index') }}"><img class="companyLogo"
                    src="{{ url_for('static', filename='img/companyLogo.png') }}" alt="Logo"></a>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body pt-0">
            <ul class="navbar-nav stroke ms-auto">
                <li class="nav-item navtext">
                    <a class="nav-link " aria-current="page" href="{{ url_for('home.index') }}"><i
                            class="bi bi-house-door-fill me-2 fs-5"></i>Home</a>
                </li>
                <li class="nav-item navtext">
                    <a class="nav-link " href="{{ url_for('product.products_page') }}"><i
                            class="bi bi-cpu me-2 fs-5"></i>Products</a>
                </li>
                <li id="service_section_nav_link" class="nav-item navtext">
                    <a class="nav-link " href="{{ url_for('home.index') }}#ServiceSection">Services</a>
                </li>
                </li>
                <li class="nav-item navtext">
                    <a class="nav-link " href="#Category"><i class="bi bi-diagram-3 fs-6 me-2"></i>Category</a>
                </li>

                <li class="nav-item navtext">
                    <a class="nav-link " href="#About"><i class="bi bi-x-diamond-fill me-2 fs-6"></i>About</a>
                </li>
                <li class="nav-item navtext">
                    <a class="nav-link" href="#contact"><i class="bi bi-telephone-inbound me-2 fs-6"></i>Contact</a>
                </li>
            </ul>
            <div class="navbar-nav ms-auto px-1">
                <div class="Navbardropdown-container nav_login_div" onclick="toggleDropdown(this)">

                </div>
            </div>

            <ul class="navbar-nav bottomNavItems nav_cart_wish_Btns" style="display: none;">

                <li class="nav-item navtext">
                    <a class="nav-link" href="{{ url_for('wishlist.wishlist_page') }}"><i
                            class="bi bi-heart  me-2 fs-5"></i>WishList
                        <span class="wishBtnTooltip" id="wishBtnTooltip"></span>

                    </a>

                </li>
                <li class="nav-item navtext">
                    <a class="nav-link " href="{{ url_for('cart.cart_page') }}"><i
                            class="bi bi-cart4 me-2 fs-5"></i>Cart
                        <span class="cartBtnTooltip" id="cartBtnTooltip"></span>

                    </a>
                </li>

            </ul>
        </div>
    </div>
    <!-- Navbar End -->

    <div class="container-fluid" style="min-height: 600px;">
        {% block content %}{% endblock %}
    </div>
    <div class="chatbox-wrapper" style="z-index: 10;">
        <div class="chatbox-toggle">
            <i class="bi bi-chat-left"></i>
        </div>
        <div class="chatbox-message-wrapper">
            <div class="card rounded-0">
                <div class="card-header">
                    <!-- <button class="btn btn-light btn-sm float-start ">Back</button> -->
                    <h5 class="text-center">Messages</h5>
                </div>
                <div class="card-body p-1" style="overflow-y: scroll; height: 300px;" id="messageBox">

                </div>
                <div class="card-footer">
                    <form enctype="multipart/form-data" id="adminForm">
                        <div class="row">
                            <div class="col-10 p-0 m-0">
                                <input type="text" class="form-control form-control-sm" name="message" required>
                            </div>
                            <div class="col-1 p-0 m-0">
                                <label for="attachement_url">
                                    <i class="bi bi-paperclip fs-5 p-0 m-0 btn btn-outline-dark border-0"></i>
                                </label>
                                <input type="file" name="attachement_url" class="d-none" ,
                                    accept="jpg|jpeg|png|webp|gif|docs|pdf|xlxs" , id="attachement_url">
                            </div>
                            <div class="col-1 p-0 m-0">
                                <button type="submit" class="btn btn-dark btn-sm float-end" id="message_send_btn"><i
                                        class="bi bi-send"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer section -->
    <footer id="footer" class="pt-4 pb-2">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-4 col-sm-6 footer-contact mb-3 col-12 ">
                    <h3>Sagar Services</h3>
                    <p>
                        Sagar Services | DurgaBari, Cooch Behar–736172
                        <br><br>
                        <strong>Phone:</strong> +91 7362264320, +91 7361564320<br>
                        <strong>Email:</strong> sagar@services.com<br>
                    </p>
                </div>
                <div class="col-md-3 col-lg-2 col-sm-6 col-6 footer-links mb-3">
                    <h5><strong>Information</strong></h5>
                    <ul class="change-text px-2">
                        <li><i class="bi bi-caret-right"></i> <a href="#">Discounts</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#AboutSection">Brands</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#ServiceSection">FAQ</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Products Types</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-lg-2 col-sm-6 col-6 footer-links mb-3">
                    <h5><strong>My Account</strong></h5>
                    <ul class="change-text px-2">
                        <li><i class="bi bi-caret-right"></i> <a href="#">My Account</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Track Order</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Wish List</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Order History</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-lg-2 col-sm-6 col-6 footer-links mb-3">
                    <h5><strong>Useful Links</strong></h5>
                    <ul class="change-text px-2">
                        <li><i class="bi bi-caret-right"></i> <a href="#">Home</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">About us</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Products</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Privacy policy</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-lg-2 col-sm-6 col-6 footer-links mb-3">
                    <h5><strong>Our Services</strong></h5>
                    <ul class="change-text">
                        <li><i class="bi bi-caret-right"></i> <a href="#">Assemble Computer</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Order Products</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Repair Products</a></li>
                        <li><i class="bi bi-caret-right"></i> <a href="#">Exchange Products</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="container pb-4 pt-2">
            <div class="social-links text-center pt-md-0">
                <a href="#" class="twitter social-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter"
                    data-bs-custom-class="custom-tooltip"><i class="bi bi-twitter-x"></i></a>
                <a href="#" class="facebook social-icon" data-bs-toggle="tooltip" data-bs-placement="top"
                    title="Facebook" data-bs-custom-class="custom-tooltip"><i class="bi bi-facebook"></i></a>
                <a href="#" class="instagram social-icon" data-bs-toggle="tooltip" data-bs-placement="top"
                    title="Instagram" data-bs-custom-class="custom-tooltip"><i class="bi bi-instagram"></i></a>
                <a href="#" class="email social-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Email"
                    data-bs-custom-class="custom-tooltip"><i class="bi bi-envelope-paper"></i></a>

            </div>
            <div class="text-center pt-2">
                <div class="copyright">
                    &copy; Copyright <strong><span>Sagar Services</span></strong>. All Rights Reserved
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer section -->

    <!-- ScrollButton -->
    <div onclick="scrollToTop()" id="scrollDiv">
        <span class="material-symbols-outlined" id="scrollButton"><i class="bi bi-caret-up"></i></i></span>
    </div>
    <!-- ScrollButton End -->


    <script src="{{ url_for('static', filename='js/sujit.js') }}"></script>
    <script src="{{ url_for('static', filename='js/subhasis.js') }}"></script>
    <script src="{{ url_for('static', filename='js/arif.js') }}"></script>
    <script src="{{ url_for('static', filename='js/pawan.js') }}"></script>

    <script>
        $(document).ready(function () {
            function get_total_cart_and_wish() {
                $('.nav_login_div').html = '';
                $.ajax({
                    url: "{{ url_for('home.get_total_cart_and_wish') }}",
                    type: "POST",
                    dataType: "json",
                    success: function (response) {
                        if (response.status) {
                            if (response.status == "success") {
                                $(".cartBtnTooltip").html(response.data.totalCart);
                                $(".wishBtnTooltip").html(response.data.totalWish);
                                $(".nav_cart_wish_Btns").show();
                                html_after_login = ''
                                html_after_login += `<img src="../../static/${response.user_profile_photo_url ? response.user_profile_photo_url : 'img/AVTAR.jpg'}"
                    style="object-fit: cover;max-width: 45px; max-height: 45px;border-radius: 100%;" class="nav-item"
                    height="50px" alt="">
                    <ul class="dropdown-menu px-md-0">
                        <li><a class="dropdown-item px-md-0" href="{{ url_for('user.my_profile_page') }}">My Profile</a></li>
                        <li><a class="dropdown-item px-md-0" href="{{ url_for('auth.logout') }}">Log Out</a></li>
                    </ul>`;
                                $('.nav_login_div').append(html_after_login);
                            } else {
                                html_before_login = ''
                                html_before_login += `<li class="nav-item navtext">
                            <a class="nav-link loginBtn" href="{{ url_for('auth.login') }}">Sign In</a>
                        </li>`
                                $('.nav_login_div').append(html_before_login);
                                $(".nav_cart_wish_Btns").hide();
                            }
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching cart details:', error);
                    }
                });
            }
            get_total_cart_and_wish();

            function populateChatBox() {
                $('#messageBox').empty();
                $.ajax({
                    url: "{{ url_for('message.chatbox') }}",
                    type: "GET",
                    dataType: "json",
                    success: function (response) {
                        if (response.status) {
                            if (response.status == "failed") {
                                $("#message_send_btn").on("click", function () {
                                    window.location.href = "/login"
                                })
                            }
                        }
                        else {
                            var messages = response;
                            $('#messageBox').html('')
                            chats = '';
                            messages.forEach(function (message) {
                                if (message.current_user_id == message.created_by) {
                                    chats += `<div class="card border-0 w-75 ms-auto shadow-none">
                                        <div class="card-body">
                                            <p class="small text-end text-muted">
                                                <i class="bi bi-person me-1"></i>
                                                ${message.sent_by} -
                                                <span>${getFormattedTime(message.created_at)}</span>
                                            </p>
                                            <p class="card-text text-end">
                                                <span style="padding: 3px 4px; background-color: #0009; color:#fff; width: fit-content; border-radius: 8px 0px 8px 8px;">
                                                    ${message.message}
                                                </span>
                                                <p class=" w-100 text-end p-0 m-0">`;
                                    if (message.attachement_url) {
                                        chats += `<a href="${message.attachement_url}" download class="text-decoration-none text-dark"><i class="bi bi-paperclip fs-5 p-0 m-0"></i>attachment</a>`;
                                    }
                                    chats += `</p>
                                            </p>
                                        </div>
                                    </div>`;
                                }
                                else {
                                    chats += `
                                    <div class="card border-0 w-75 shadow-none">
                                        <div class="card-body">
                                            <p class="small text-muted">
                                                <i class="bi bi-person me-1"></i>
                                                sagar services -
                                                <span>${getFormattedTime(message.created_at)}</span>
                                            </p>
                                            <p class="card-text">
                                                <span style="padding: 3px 4px; background-color: #0002; width: fit-content; border-radius: 0px 8px 8px 8px; ">
                                                    ${message.message}
                                                </span>
                                                <p class=" w-100 p-0 m-0">`;

                                    if (message.attachement_url) {
                                        chats += `<a href="${message.attachement_url}" download class="text-decoration-none text-dark"><i class="bi bi-paperclip fs-5 p-0 m-0"></i>attachment</a>`;
                                    }
                                    chats += `</p>
                                            </p>
                                        </div>
                                    </div>`;
                                }
                            });
                            $('#messageBox').html(chats)
                            $('#messageBox').scrollTop($('#messageBox')[0].scrollHeight);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching cart details:', error);
                    }
                });
            }
            populateChatBox();



            $('#adminForm').submit(function (event) {
                event.preventDefault();
                var formData = new FormData($(this)[0]);

                $.ajax({
                    url: '{{ url_for("message.write") }}',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        $('#messageBox').scrollTop($('#messageBox')[0].scrollHeight);
                        // $('#messageBox').append('')
                        $('input').val('')
                        populateChatBox();
                    },
                    error: function (xhr, status, error) {

                    }
                });
            });
        })



        // window.addEventListener('scroll', function () {
        //     let scrollPosition = window.scrollY;
        //     document.querySelectorAll('.nav-link').forEach(link => {
        //         let sectionId = link.getAttribute('href').substring(1);
        //         let section = document.getElementById(sectionId);
        //         let navbarHeight = document.getElementById('navbarSupportedContent').offsetHeight;

        //         if (section) {
        //             let sectionTop = section.getBoundingClientRect().top + window.scrollY - navbarHeight;
        //             let sectionHeight = section.offsetHeight;

        //             if (scrollPosition >= sectionTop && scrollPosition < (sectionTop + sectionHeight)) {
        //                 link.classList.add('active');
        //             } else {
        //                 link.classList.remove('active');
        //             }
        //         }
        //     });
        // });
    </script>
</body>

</html>