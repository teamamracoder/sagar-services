{% extends 'customer/base.html' %} 

{% block title %}Cart{% endblock %} 
{% block content %}

<div class="container">
  <nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{{ url_for('home.index') }}"><i class="bi bi-house"></i></a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">Cart</li>
    </ol>
  </nav>
  <div class="row align-items-start">

    <div class="col-lg-8 col-md-8 col-sm-12">
      <table class="table table-bordered cart-table">
        <thead class="table table-dark table-sm">
          <tr>
            <td>Image</td>
            <td>Product Name</td>
            <td>Model</td>
            <td>Price</td>
            <td>Actions</td>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
    </div>
    <div class="col-md-4 col-lg-4 col-sm-12">
      <table class="table table-bordered summary-table">
        <tbody>
          <tr class="table-light">
            <td class="">Sub-Total:</td>
            <td class="">
              <i class="bi bi-currency-rupee"></i
              ><span class="subtotal">123</span>
            </td>
          </tr>
          <tr class="table-light">
            <td class="">Discount:</td>
            <td class="">
              <i class="bi bi-currency-rupee"></i
              ><span class="discount">123</span>
            </td>
          </tr>
          <tr class="table-secondary">
            <td><b>Total-Price:</b></td>
            <td>
              <b
                ><i class="bi bi-currency-rupee"></i
                ><span class="total-price">123</span></b
              >
            </td>
          </tr>
        </tbody>
      </table>
      <div class="d-flex justify-content-between">
        <a href="" class="btn link-blue">Continue Shopping</a>
        <a href="" class="btn btn-outline-blue">Checkout</a>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
        // Function to fetch cart details
        function fetchCartDetails() {
            $.ajax({
                url: "{{ url_for('cart.cart_page_data') }}",
                type: "GET",
                success: function (response) {
                    // Call function to render cart details
                    renderCartDetails(response);
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching cart details:', error);
                    // Handle error, show error message, etc.
                }
            });
        }

        // Function to render cart details on the frontend
        function renderCartDetails(cartDetails) {
            var cartTable = $('.cart-table tbody');
            var subtotalSpan = $('.subtotal');
            var discountSpan = $('.discount');
            var totalPriceSpan = $('.total-price');

            // Clear previous content
            cartTable.empty();
            subtotalSpan.text('0');
            discountSpan.text('0');
            totalPriceSpan.text('0');

            // Iterate over cart details and append to the DOM
            cartDetails.forEach(function (item) {
                subTotal = parseFloat(subtotalSpan.text())+item.price
                totalDiscount = parseFloat(discountSpan.text())+item.discount
                totalPrice = subTotal - totalDiscount

                //Update subtotal, toal discount, and total pcice
                subtotalSpan.text(subTotal.toFixed(2));
                discountSpan.text(totalDiscount.toFixed(2));
                totalPriceSpan.text(totalPrice.toFixed(2));

                // Append cart item to the cart table
                if(item.image.length>0){
                    product_image=item.image[0]
                }
                else{
                    product_image=null
                }
                cartTable.append(`
                    <tr class="cart_item_${item.id}">
                        <td>${product_image ? `<img src="../../static/${product_image}" alt="Product Image" width="50">` : ''}</td>
                        <td>${item.product_name}</td>
                        <td>${item.model}</td>
                        <td>${item.price.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-outline-blue border-0" data-toggle="tooltip"  data-bs-placement="bottom"  title="remove" onclick="removeFromCart(${item.id})"><i class="bi bi-trash3"></i></button> 
                            <button class="btn btn-outline-blue border-0" data-toggle="tooltip"  data-bs-placement="bottom"  title="checkout" onclick="buyNow(${item.product_id})"><i class="bi bi-bag"></i></button> 
                        </td>
                    </tr>
                `);
            });
        }
        // Call fetchCartDetails function to fetch cart details
        fetchCartDetails();
    });
    window.removeFromCart = function(cart_id){
        $.ajax({
                url: "{{ url_for('cart.status',id=0) }}".replace('0',cart_id),
                type: "GET",
                complete:res=> {
                    responseData=res.responseJSON
                        if (responseData.status === 'success') {
                            if(!responseData.data){
                                toastr.success("Product Removed Cart");
                                $(".cart_item_"+cart_id).css("display","none")
                            }
                        }
                        else{
                            toastr.error(responseData.message);
                        }
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching cart details:', error);
                }
            });
    }
</script>

{% endblock %}
