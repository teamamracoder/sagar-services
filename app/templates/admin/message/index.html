{% extends 'admin/base.html' %}

{% block title %}Messages{% endblock %}

{% block content %}

<div class="container">
    <h3 class="text-center my-3">Messages</h3>
    <div class="row justify-content-center">
        <div class="col-lg-4 col-md-6 col-sm-12">
            <div class="card rounded-0" style="overflow-y: scroll; height:500px;" id="messageBox">
                <div class="card-body p-1">
                    {% for message in messages %}
                    <div class="card border-0">
                        <div class="card-header">
                            {{ message.sent_by }} - <span id="time_{{ loop.index }}"></span>
                        </div>
                        <div class="card-body">
                            <p class="card-text">{{ message.message }}</p>
                        </div>
                    </div>
                    <script>
                        var time=getFormattedTime("{{ message.created_at }}")
                        $("#time_{{ loop.index }}").text(time);
                    </script>
                    {% endfor %}
                </div>
                <div class="card-footer">
                    <form method="POST" action="{{ url_for('message.add',conversation_id=conversation_id) }}" enctype="multipart/form-data"  id="adminForm">
                        {{ form.csrf_token }}
                        <div class="row">
                            <div class="col-12">
                                {{ form.message(class="form-control form-control-sm") }}
                            </div>
                            <div class="col-12 my-2">
                                <button type="submit" class="btn btn-dark btn-sm float-end">Send</button>
                                <a href="{{ url_for('conversation.index') }}" class="btn btn-outline-dark btn-sm float-end me-2">Back</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
</div>

<script>
    $(document).ready(function () {
        $('#messageBox').scrollTop($('#messageBox')[0].scrollHeight);
        window.editRecord = function (id) {
            window.location.href= "/admin/messages/update/" + id;
        };

        window.deactivateRecord = function (id) {
            window.location.href= "/admin/messages/status/" + id;
        };
    });
</script>

{% endblock %}